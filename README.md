# Backstage Workshop
## 1. Prerequisites
## Configure npmrc file with the following content, available in home directory.
1. Windows  
   a.%USERPROFILE%\.npmrc **(eg: C:\Users\username\.npmrc)**
2. Linux
   a.~/.npmrc **(eg: /home/username/.npmrc)**
3. Mac
   a.~/.npmrc **(eg: /Users/username/.npmrc)**
4. Content of the npmrc file.
   a. Add the following content to the npmrc file.

```shell
# THIS IS AN AUTOGENERATED FILE. DO NOT EDIT THIS FILE DIRECTLY.
# yarn lockfile v1
registry=https://registry.npmjs.org/
strict-ssl=false
@digital-ai:registry=https://registry.npmjs.org
```

# Setup of Digital-ai Deploy , Digital-ai Release and Backstage using script available under docker directory.
## 1. Prerequisites
### a. Install docker and docker-compose.
### b. Run the below command from the root directory of the backstage.
```shell
cd backstage-with-new-backend
yarn install
````
### b. Backstage Setup Instructions
This section outlines how to configure and run the Backstage application. Please follow the instructions carefully.

#### Running Backstage

Before you run the Backstage application, you need to update the `docker/dai-backstage_up.sh` file according to your desired method of execution:
1. **To run the backstage in docker with the github auth , dai-release and dai-deploy plugin:** 
   - Refer the [docker/README.md](docker/README.md) for more details.
   - Set the value of `START_BACKSTAGE_IN_DOCKER` to `true`.

2. **To start Backstage from a script:**
   - Set the value of `BACKSTAGE_MANUAL_INSTALL` to `false`.

3. **To start Backstage manually:**
   - Set the value of `BACKSTAGE_MANUAL_INSTALL` to `true`.
   - You will find the `.env` file in the `bacstage-new-backend` directory.

```shell
# Set Network, Environment variables and start the services.
export NETWORK_NAME=dai-backstage
export DAI_RELEASE_IMAGE=xebialabs/xl-release:24.3
export DAI_DEPLOY_IMAGE=xebialabs/xl-deploy:24.3
export DAI_BACKSTAGE_IMAGE=xebialabsunsupported/dai-backstage-docker:1.0.1
export DAI_DEPLOY_USERNAME=admin
export DAI_DEPLOY_PASSWORD=admin
export GITHUB_TOKEN=<GITHUB_TOKEN>
export AUTH_GITHUB_CLIENT_ID=<AUTH_GITHUB_CLIENT_ID>
export AUTH_GITHUB_CLIENT_SECRET=<AUTH_GITHUB_CLIENT_SECRET>
export START_BACKSTAGE_IN_DOCKER=false
export BACKSTAGE_MANUAL_INSTALL = true
```

4. Run the following command to start the deploy, release and backstage
```shell
cd docker
./dai-backstage_up.sh
```

eg: We are starting the release and deploy  with a script and updating the environment file in the `backstage-new-backend` directory.
![TerminalLog](img/terminalLog.png)
![env](img/env.png)

5. Start the Backstage application using the following command:
```shell
cd ../backstage-with-new-backend
LOG_LEVEL=debug NODE_OPTIONS=--no-node-snapshot yarn dev:env
````
6. View the Digital-ai Deploy - Active Deployment in Backstage app.
![Active Deployment](deploy/img/deployment_active.png)
7. View the Digital-ai Deploy - Archive Deployment in Backstage app.
![Archive Deployment](deploy/img/archive.png)
8. View the Digital-ai Release - Active Release in Backstage app.
![image](https://github.com/digital-ai/backstage-workshop/assets/88083340/7ae3c5d2-c73f-4f1c-adba-a4046c6e05df)
9. View Digital-ai Release - Template in Backstage app.
![Template](release/img/template.png)
10. View Digital-ai Release - Workflow in Backstage app.
![Workflow](release/img/workflow.png) 


## Setup backstage using New backend system and connect to existing Deploy and Release instance.
#### 1. Run the following command from root directory
```shell
cd backstage-with-new-backend
```
#### 3. Run the following command to start the backstage app with deploy plugin installed.
```shell
yarn install
```
#### 4. Create the .env file and update the values for the environment variables like below.
```shell
[ishwarya@ishwarya-Precision-5480 backstage-with-new-backend]* update_readme $ cat .env
GITHUB_TOKEN=ghp_vC2ZE2Xzklr6UbegqWIwle8OvAfeBR01De4Aey
DAI_RELEASE_INSTANCE1_NAME=dai-release-instance
DAI_RELEASE_INSTANCE1_TOKEN=
DAI_RELEASE_INSTANCE1_HOST=http://172.29.0.2:5516
DAI_DEPLOY_HOST=http://172.29.0.3:4516
DAI_DEPLOY_USERNAME=admin
DAI_DEPLOY_PASSWORD=admin
DAI_DEPLOY_AUTH_TOKEN=Basic YWRtaW46YWRtaW4=
```
5. Run the following command to start the backstage app.
```shell
LOG_LEVEL=debug NODE_OPTIONS=--no-node-snapshot yarn dev:env
```
6. Open your browser at http://localhost:3000 to access the backstage with the default plugins[dai-release, dai-deploy] installed.


## Documentation Links

**Digital.ai Deploy:**

* [Deploy Integration with Backstage](https://docs.digital.ai/bundle/devops-deploy-version-v.24.1/page/deploy/concept/xl-deploy-backstage-overview.html)
* [Adding Deploy to Your Backstage IDP](https://docs.digital.ai/bundle/devops-deploy-version-master/page/deploy/concept/xl-deploy-backstage-plugins.html)

**Digital.ai Release:**

* [Overview](https://docs.digital.ai/bundle/devops-release-version-v.24.1/page/release/concept/release-backstage-overview.html)
* [Adding Release Plugin to Your Backstage IDP](https://docs.digital.ai/bundle/devops-release-version-v.24.1/page/release/concept/release-backstage-plugin.html)


